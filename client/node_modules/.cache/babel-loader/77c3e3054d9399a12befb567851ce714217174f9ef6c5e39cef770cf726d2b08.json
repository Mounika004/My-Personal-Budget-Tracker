{"ast":null,"code":"import _objectSpread from\"/Users/queen/Downloads/Budget Tracker/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";// src/redux/reducers/userReducer.js\nconst initialState={user:{_id:null,username:\"\",email:\"\",friends:[],expensis:[]// canonical list\n}};// --- Helpers that look into flat fields OR doc.* and inp.* ---\nfunction pick(obj,paths){for(let p of paths){const v=p.split(\".\").reduce((o,k)=>o&&o[k]!==undefined?o[k]:undefined,obj);if(v!==undefined&&v!==null&&v!==\"\")return v;}return undefined;}function getDesc(e){return pick(e,[\"description\",\"inp.description\",\"doc.description\",\"doc.inp.description\"])||\"\";}function getAmt(e){return pick(e,[\"amount\",\"inp.amount\",\"doc.amount\",\"doc.inp.amount\"])||\"\";}function getDate(e){return pick(e,[\"date\",\"inp.date\",\"createdAt\",\"updatedAt\",\"doc.date\",\"doc.inp.date\",\"doc.createdAt\",\"doc.updatedAt\"])||\"\";}function getWho(e){return pick(e,[\"user\",\"friend\",\"paidBy\",\"with\",\"doc.user\"])||\"\";}function expSig(e){return String(getDesc(e)).trim()+\"|\"+String(getAmt(e))+\"|\"+String(getDate(e))+\"|\"+String(getWho(e));}function choosePreferReal(existing,incoming){const exId=pick(existing,[\"_id\",\"id\",\"doc._id\",\"doc.id\"]);const inId=pick(incoming,[\"_id\",\"id\",\"doc._id\",\"doc.id\"]);const exIsTemp=exId&&String(exId).startsWith(\"temp-\");const inIsTemp=inId&&String(inId).startsWith(\"temp-\");if(!exId&&inId)return incoming;if(exIsTemp&&!inIsTemp)return incoming;return incoming||existing;}function mergeExpenseArrays(baseArr,incomingArr){const bySig=new Map();(baseArr||[]).forEach(e=>bySig.set(expSig(e),e));(incomingArr||[]).forEach(e=>{const s=expSig(e);bySig.set(s,bySig.has(s)?choosePreferReal(bySig.get(s),e):e);});return Array.from(bySig.values());}export const userReducer=function(){let state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:initialState;let action=arguments.length>1?arguments[1]:undefined;switch(action.type){case\"AddUser\":{const doc=action.payload||{};const incoming=doc&&doc.user&&(doc.user.username||doc.user.friends||doc.user.expensis||doc.user.expenses)?doc.user:doc;const nextFriends=Array.isArray(incoming.friends)?incoming.friends:state.user.friends;const incomingExpRaw=Array.isArray(incoming.expensis)?incoming.expensis:Array.isArray(incoming.expenses)?incoming.expenses:undefined;const nextExpensis=Array.isArray(incomingExpRaw)?mergeExpenseArrays(state.user.expensis,incomingExpRaw):state.user.expensis;return{user:_objectSpread(_objectSpread(_objectSpread({},state.user),incoming),{},{friends:nextFriends,expensis:nextExpensis})};}case\"APPEND_EXPENSES\":{const add=Array.isArray(action.payload)?action.payload:[action.payload];return{user:_objectSpread(_objectSpread({},state.user),{},{expensis:mergeExpenseArrays(state.user.expensis,add)})};}case\"DELETE_EXPENSE\":{const targetSig=expSig(action.payload);const targetId=pick(action.payload,[\"_id\",\"id\",\"doc._id\",\"doc.id\"]);const filtered=(state.user.expensis||[]).filter(e=>{const id=pick(e,[\"_id\",\"id\",\"doc._id\",\"doc.id\"]);if(targetId&&id&&String(id)===String(targetId))return false;return expSig(e)!==targetSig;});return{user:_objectSpread(_objectSpread({},state.user),{},{expensis:filtered})};}case\"LOGOUT\":return initialState;default:return state;}};","map":{"version":3,"names":["initialState","user","_id","username","email","friends","expensis","pick","obj","paths","p","v","split","reduce","o","k","undefined","getDesc","e","getAmt","getDate","getWho","expSig","String","trim","choosePreferReal","existing","incoming","exId","inId","exIsTemp","startsWith","inIsTemp","mergeExpenseArrays","baseArr","incomingArr","bySig","Map","forEach","set","s","has","get","Array","from","values","userReducer","state","arguments","length","action","type","doc","payload","expenses","nextFriends","isArray","incomingExpRaw","nextExpensis","_objectSpread","add","targetSig","targetId","filtered","filter","id"],"sources":["/Users/queen/Downloads/Budget Tracker/client/src/redux/reducers/userReducer.js"],"sourcesContent":["// src/redux/reducers/userReducer.js\r\n\r\nconst initialState = {\r\n  user: {\r\n    _id: null,\r\n    username: \"\",\r\n    email: \"\",\r\n    friends: [],\r\n    expensis: [], // canonical list\r\n  },\r\n};\r\n\r\n// --- Helpers that look into flat fields OR doc.* and inp.* ---\r\nfunction pick(obj, paths) {\r\n  for (let p of paths) {\r\n    const v = p\r\n      .split(\".\")\r\n      .reduce((o, k) => (o && o[k] !== undefined ? o[k] : undefined), obj);\r\n    if (v !== undefined && v !== null && v !== \"\") return v;\r\n  }\r\n  return undefined;\r\n}\r\nfunction getDesc(e) {\r\n  return (\r\n    pick(e, [\r\n      \"description\",\r\n      \"inp.description\",\r\n      \"doc.description\",\r\n      \"doc.inp.description\",\r\n    ]) || \"\"\r\n  );\r\n}\r\nfunction getAmt(e) {\r\n  return (\r\n    pick(e, [\"amount\", \"inp.amount\", \"doc.amount\", \"doc.inp.amount\"]) || \"\"\r\n  );\r\n}\r\nfunction getDate(e) {\r\n  return (\r\n    pick(e, [\r\n      \"date\",\r\n      \"inp.date\",\r\n      \"createdAt\",\r\n      \"updatedAt\",\r\n      \"doc.date\",\r\n      \"doc.inp.date\",\r\n      \"doc.createdAt\",\r\n      \"doc.updatedAt\",\r\n    ]) || \"\"\r\n  );\r\n}\r\nfunction getWho(e) {\r\n  return pick(e, [\"user\", \"friend\", \"paidBy\", \"with\", \"doc.user\"]) || \"\";\r\n}\r\n\r\nfunction expSig(e) {\r\n  return (\r\n    String(getDesc(e)).trim() +\r\n    \"|\" +\r\n    String(getAmt(e)) +\r\n    \"|\" +\r\n    String(getDate(e)) +\r\n    \"|\" +\r\n    String(getWho(e))\r\n  );\r\n}\r\n\r\nfunction choosePreferReal(existing, incoming) {\r\n  const exId = pick(existing, [\"_id\", \"id\", \"doc._id\", \"doc.id\"]);\r\n  const inId = pick(incoming, [\"_id\", \"id\", \"doc._id\", \"doc.id\"]);\r\n  const exIsTemp = exId && String(exId).startsWith(\"temp-\");\r\n  const inIsTemp = inId && String(inId).startsWith(\"temp-\");\r\n  if (!exId && inId) return incoming;\r\n  if (exIsTemp && !inIsTemp) return incoming;\r\n  return incoming || existing;\r\n}\r\n\r\nfunction mergeExpenseArrays(baseArr, incomingArr) {\r\n  const bySig = new Map();\r\n  (baseArr || []).forEach((e) => bySig.set(expSig(e), e));\r\n  (incomingArr || []).forEach((e) => {\r\n    const s = expSig(e);\r\n    bySig.set(s, bySig.has(s) ? choosePreferReal(bySig.get(s), e) : e);\r\n  });\r\n  return Array.from(bySig.values());\r\n}\r\n\r\nexport const userReducer = (state = initialState, action) => {\r\n  switch (action.type) {\r\n    case \"AddUser\": {\r\n      const doc = action.payload || {};\r\n      const incoming =\r\n        doc &&\r\n        doc.user &&\r\n        (doc.user.username ||\r\n          doc.user.friends ||\r\n          doc.user.expensis ||\r\n          doc.user.expenses)\r\n          ? doc.user\r\n          : doc;\r\n\r\n      const nextFriends = Array.isArray(incoming.friends)\r\n        ? incoming.friends\r\n        : state.user.friends;\r\n\r\n      const incomingExpRaw = Array.isArray(incoming.expensis)\r\n        ? incoming.expensis\r\n        : Array.isArray(incoming.expenses)\r\n        ? incoming.expenses\r\n        : undefined;\r\n\r\n      const nextExpensis = Array.isArray(incomingExpRaw)\r\n        ? mergeExpenseArrays(state.user.expensis, incomingExpRaw)\r\n        : state.user.expensis;\r\n\r\n      return {\r\n        user: {\r\n          ...state.user,\r\n          ...incoming,\r\n          friends: nextFriends,\r\n          expensis: nextExpensis,\r\n        },\r\n      };\r\n    }\r\n\r\n    case \"APPEND_EXPENSES\": {\r\n      const add = Array.isArray(action.payload)\r\n        ? action.payload\r\n        : [action.payload];\r\n      return {\r\n        user: {\r\n          ...state.user,\r\n          expensis: mergeExpenseArrays(state.user.expensis, add),\r\n        },\r\n      };\r\n    }\r\n\r\n    case \"DELETE_EXPENSE\": {\r\n      const targetSig = expSig(action.payload);\r\n      const targetId = pick(action.payload, [\"_id\", \"id\", \"doc._id\", \"doc.id\"]);\r\n      const filtered = (state.user.expensis || []).filter((e) => {\r\n        const id = pick(e, [\"_id\", \"id\", \"doc._id\", \"doc.id\"]);\r\n        if (targetId && id && String(id) === String(targetId)) return false;\r\n        return expSig(e) !== targetSig;\r\n      });\r\n      return { user: { ...state.user, expensis: filtered } };\r\n    }\r\n\r\n    case \"LOGOUT\":\r\n      return initialState;\r\n\r\n    default:\r\n      return state;\r\n  }\r\n};\r\n"],"mappings":"iIAAA;AAEA,KAAM,CAAAA,YAAY,CAAG,CACnBC,IAAI,CAAE,CACJC,GAAG,CAAE,IAAI,CACTC,QAAQ,CAAE,EAAE,CACZC,KAAK,CAAE,EAAE,CACTC,OAAO,CAAE,EAAE,CACXC,QAAQ,CAAE,EAAI;AAChB,CACF,CAAC,CAED;AACA,QAAS,CAAAC,IAAIA,CAACC,GAAG,CAAEC,KAAK,CAAE,CACxB,IAAK,GAAI,CAAAC,CAAC,GAAI,CAAAD,KAAK,CAAE,CACnB,KAAM,CAAAE,CAAC,CAAGD,CAAC,CACRE,KAAK,CAAC,GAAG,CAAC,CACVC,MAAM,CAAC,CAACC,CAAC,CAAEC,CAAC,GAAMD,CAAC,EAAIA,CAAC,CAACC,CAAC,CAAC,GAAKC,SAAS,CAAGF,CAAC,CAACC,CAAC,CAAC,CAAGC,SAAU,CAAER,GAAG,CAAC,CACtE,GAAIG,CAAC,GAAKK,SAAS,EAAIL,CAAC,GAAK,IAAI,EAAIA,CAAC,GAAK,EAAE,CAAE,MAAO,CAAAA,CAAC,CACzD,CACA,MAAO,CAAAK,SAAS,CAClB,CACA,QAAS,CAAAC,OAAOA,CAACC,CAAC,CAAE,CAClB,MACE,CAAAX,IAAI,CAACW,CAAC,CAAE,CACN,aAAa,CACb,iBAAiB,CACjB,iBAAiB,CACjB,qBAAqB,CACtB,CAAC,EAAI,EAAE,CAEZ,CACA,QAAS,CAAAC,MAAMA,CAACD,CAAC,CAAE,CACjB,MACE,CAAAX,IAAI,CAACW,CAAC,CAAE,CAAC,QAAQ,CAAE,YAAY,CAAE,YAAY,CAAE,gBAAgB,CAAC,CAAC,EAAI,EAAE,CAE3E,CACA,QAAS,CAAAE,OAAOA,CAACF,CAAC,CAAE,CAClB,MACE,CAAAX,IAAI,CAACW,CAAC,CAAE,CACN,MAAM,CACN,UAAU,CACV,WAAW,CACX,WAAW,CACX,UAAU,CACV,cAAc,CACd,eAAe,CACf,eAAe,CAChB,CAAC,EAAI,EAAE,CAEZ,CACA,QAAS,CAAAG,MAAMA,CAACH,CAAC,CAAE,CACjB,MAAO,CAAAX,IAAI,CAACW,CAAC,CAAE,CAAC,MAAM,CAAE,QAAQ,CAAE,QAAQ,CAAE,MAAM,CAAE,UAAU,CAAC,CAAC,EAAI,EAAE,CACxE,CAEA,QAAS,CAAAI,MAAMA,CAACJ,CAAC,CAAE,CACjB,MACE,CAAAK,MAAM,CAACN,OAAO,CAACC,CAAC,CAAC,CAAC,CAACM,IAAI,CAAC,CAAC,CACzB,GAAG,CACHD,MAAM,CAACJ,MAAM,CAACD,CAAC,CAAC,CAAC,CACjB,GAAG,CACHK,MAAM,CAACH,OAAO,CAACF,CAAC,CAAC,CAAC,CAClB,GAAG,CACHK,MAAM,CAACF,MAAM,CAACH,CAAC,CAAC,CAAC,CAErB,CAEA,QAAS,CAAAO,gBAAgBA,CAACC,QAAQ,CAAEC,QAAQ,CAAE,CAC5C,KAAM,CAAAC,IAAI,CAAGrB,IAAI,CAACmB,QAAQ,CAAE,CAAC,KAAK,CAAE,IAAI,CAAE,SAAS,CAAE,QAAQ,CAAC,CAAC,CAC/D,KAAM,CAAAG,IAAI,CAAGtB,IAAI,CAACoB,QAAQ,CAAE,CAAC,KAAK,CAAE,IAAI,CAAE,SAAS,CAAE,QAAQ,CAAC,CAAC,CAC/D,KAAM,CAAAG,QAAQ,CAAGF,IAAI,EAAIL,MAAM,CAACK,IAAI,CAAC,CAACG,UAAU,CAAC,OAAO,CAAC,CACzD,KAAM,CAAAC,QAAQ,CAAGH,IAAI,EAAIN,MAAM,CAACM,IAAI,CAAC,CAACE,UAAU,CAAC,OAAO,CAAC,CACzD,GAAI,CAACH,IAAI,EAAIC,IAAI,CAAE,MAAO,CAAAF,QAAQ,CAClC,GAAIG,QAAQ,EAAI,CAACE,QAAQ,CAAE,MAAO,CAAAL,QAAQ,CAC1C,MAAO,CAAAA,QAAQ,EAAID,QAAQ,CAC7B,CAEA,QAAS,CAAAO,kBAAkBA,CAACC,OAAO,CAAEC,WAAW,CAAE,CAChD,KAAM,CAAAC,KAAK,CAAG,GAAI,CAAAC,GAAG,CAAC,CAAC,CACvB,CAACH,OAAO,EAAI,EAAE,EAAEI,OAAO,CAAEpB,CAAC,EAAKkB,KAAK,CAACG,GAAG,CAACjB,MAAM,CAACJ,CAAC,CAAC,CAAEA,CAAC,CAAC,CAAC,CACvD,CAACiB,WAAW,EAAI,EAAE,EAAEG,OAAO,CAAEpB,CAAC,EAAK,CACjC,KAAM,CAAAsB,CAAC,CAAGlB,MAAM,CAACJ,CAAC,CAAC,CACnBkB,KAAK,CAACG,GAAG,CAACC,CAAC,CAAEJ,KAAK,CAACK,GAAG,CAACD,CAAC,CAAC,CAAGf,gBAAgB,CAACW,KAAK,CAACM,GAAG,CAACF,CAAC,CAAC,CAAEtB,CAAC,CAAC,CAAGA,CAAC,CAAC,CACpE,CAAC,CAAC,CACF,MAAO,CAAAyB,KAAK,CAACC,IAAI,CAACR,KAAK,CAACS,MAAM,CAAC,CAAC,CAAC,CACnC,CAEA,MAAO,MAAM,CAAAC,WAAW,CAAG,QAAAA,CAAA,CAAkC,IAAjC,CAAAC,KAAK,CAAAC,SAAA,CAAAC,MAAA,IAAAD,SAAA,MAAAhC,SAAA,CAAAgC,SAAA,IAAGhD,YAAY,IAAE,CAAAkD,MAAM,CAAAF,SAAA,CAAAC,MAAA,GAAAD,SAAA,IAAAhC,SAAA,CACtD,OAAQkC,MAAM,CAACC,IAAI,EACjB,IAAK,SAAS,CAAE,CACd,KAAM,CAAAC,GAAG,CAAGF,MAAM,CAACG,OAAO,EAAI,CAAC,CAAC,CAChC,KAAM,CAAA1B,QAAQ,CACZyB,GAAG,EACHA,GAAG,CAACnD,IAAI,GACPmD,GAAG,CAACnD,IAAI,CAACE,QAAQ,EAChBiD,GAAG,CAACnD,IAAI,CAACI,OAAO,EAChB+C,GAAG,CAACnD,IAAI,CAACK,QAAQ,EACjB8C,GAAG,CAACnD,IAAI,CAACqD,QAAQ,CAAC,CAChBF,GAAG,CAACnD,IAAI,CACRmD,GAAG,CAET,KAAM,CAAAG,WAAW,CAAGZ,KAAK,CAACa,OAAO,CAAC7B,QAAQ,CAACtB,OAAO,CAAC,CAC/CsB,QAAQ,CAACtB,OAAO,CAChB0C,KAAK,CAAC9C,IAAI,CAACI,OAAO,CAEtB,KAAM,CAAAoD,cAAc,CAAGd,KAAK,CAACa,OAAO,CAAC7B,QAAQ,CAACrB,QAAQ,CAAC,CACnDqB,QAAQ,CAACrB,QAAQ,CACjBqC,KAAK,CAACa,OAAO,CAAC7B,QAAQ,CAAC2B,QAAQ,CAAC,CAChC3B,QAAQ,CAAC2B,QAAQ,CACjBtC,SAAS,CAEb,KAAM,CAAA0C,YAAY,CAAGf,KAAK,CAACa,OAAO,CAACC,cAAc,CAAC,CAC9CxB,kBAAkB,CAACc,KAAK,CAAC9C,IAAI,CAACK,QAAQ,CAAEmD,cAAc,CAAC,CACvDV,KAAK,CAAC9C,IAAI,CAACK,QAAQ,CAEvB,MAAO,CACLL,IAAI,CAAA0D,aAAA,CAAAA,aAAA,CAAAA,aAAA,IACCZ,KAAK,CAAC9C,IAAI,EACV0B,QAAQ,MACXtB,OAAO,CAAEkD,WAAW,CACpBjD,QAAQ,CAAEoD,YAAY,EAE1B,CAAC,CACH,CAEA,IAAK,iBAAiB,CAAE,CACtB,KAAM,CAAAE,GAAG,CAAGjB,KAAK,CAACa,OAAO,CAACN,MAAM,CAACG,OAAO,CAAC,CACrCH,MAAM,CAACG,OAAO,CACd,CAACH,MAAM,CAACG,OAAO,CAAC,CACpB,MAAO,CACLpD,IAAI,CAAA0D,aAAA,CAAAA,aAAA,IACCZ,KAAK,CAAC9C,IAAI,MACbK,QAAQ,CAAE2B,kBAAkB,CAACc,KAAK,CAAC9C,IAAI,CAACK,QAAQ,CAAEsD,GAAG,CAAC,EAE1D,CAAC,CACH,CAEA,IAAK,gBAAgB,CAAE,CACrB,KAAM,CAAAC,SAAS,CAAGvC,MAAM,CAAC4B,MAAM,CAACG,OAAO,CAAC,CACxC,KAAM,CAAAS,QAAQ,CAAGvD,IAAI,CAAC2C,MAAM,CAACG,OAAO,CAAE,CAAC,KAAK,CAAE,IAAI,CAAE,SAAS,CAAE,QAAQ,CAAC,CAAC,CACzE,KAAM,CAAAU,QAAQ,CAAG,CAAChB,KAAK,CAAC9C,IAAI,CAACK,QAAQ,EAAI,EAAE,EAAE0D,MAAM,CAAE9C,CAAC,EAAK,CACzD,KAAM,CAAA+C,EAAE,CAAG1D,IAAI,CAACW,CAAC,CAAE,CAAC,KAAK,CAAE,IAAI,CAAE,SAAS,CAAE,QAAQ,CAAC,CAAC,CACtD,GAAI4C,QAAQ,EAAIG,EAAE,EAAI1C,MAAM,CAAC0C,EAAE,CAAC,GAAK1C,MAAM,CAACuC,QAAQ,CAAC,CAAE,MAAO,MAAK,CACnE,MAAO,CAAAxC,MAAM,CAACJ,CAAC,CAAC,GAAK2C,SAAS,CAChC,CAAC,CAAC,CACF,MAAO,CAAE5D,IAAI,CAAA0D,aAAA,CAAAA,aAAA,IAAOZ,KAAK,CAAC9C,IAAI,MAAEK,QAAQ,CAAEyD,QAAQ,EAAG,CAAC,CACxD,CAEA,IAAK,QAAQ,CACX,MAAO,CAAA/D,YAAY,CAErB,QACE,MAAO,CAAA+C,KAAK,CAChB,CACF,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}