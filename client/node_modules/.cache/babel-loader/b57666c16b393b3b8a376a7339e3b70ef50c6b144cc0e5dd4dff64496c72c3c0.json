{"ast":null,"code":"// src/redux/reducers/userReducer.js\n\nconst initialState = {\n  user: {\n    _id: null,\n    username: \"\",\n    email: \"\",\n    friends: [],\n    expensis: [] // canonical list\n  }\n};\n\n// --- Helpers that look into flat fields OR doc.* and inp.* ---\nfunction pick(obj, paths) {\n  for (let p of paths) {\n    const v = p.split(\".\").reduce((o, k) => o && o[k] !== undefined ? o[k] : undefined, obj);\n    if (v !== undefined && v !== null && v !== \"\") return v;\n  }\n  return undefined;\n}\nfunction getDesc(e) {\n  return pick(e, [\"description\", \"inp.description\", \"doc.description\", \"doc.inp.description\"]) || \"\";\n}\nfunction getAmt(e) {\n  return pick(e, [\"amount\", \"inp.amount\", \"doc.amount\", \"doc.inp.amount\"]) || \"\";\n}\nfunction getDate(e) {\n  return pick(e, [\"date\", \"inp.date\", \"createdAt\", \"updatedAt\", \"doc.date\", \"doc.inp.date\", \"doc.createdAt\", \"doc.updatedAt\"]) || \"\";\n}\nfunction getWho(e) {\n  return pick(e, [\"user\", \"friend\", \"paidBy\", \"with\", \"doc.user\"]) || \"\";\n}\nfunction expSig(e) {\n  return String(getDesc(e)).trim() + \"|\" + String(getAmt(e)) + \"|\" + String(getDate(e)) + \"|\" + String(getWho(e));\n}\nfunction choosePreferReal(existing, incoming) {\n  const exId = pick(existing, [\"_id\", \"id\", \"doc._id\", \"doc.id\"]);\n  const inId = pick(incoming, [\"_id\", \"id\", \"doc._id\", \"doc.id\"]);\n  const exIsTemp = exId && String(exId).startsWith(\"temp-\");\n  const inIsTemp = inId && String(inId).startsWith(\"temp-\");\n  if (!exId && inId) return incoming;\n  if (exIsTemp && !inIsTemp) return incoming;\n  return incoming || existing;\n}\nfunction mergeExpenseArrays(baseArr, incomingArr) {\n  const bySig = new Map();\n  (baseArr || []).forEach(e => bySig.set(expSig(e), e));\n  (incomingArr || []).forEach(e => {\n    const s = expSig(e);\n    bySig.set(s, bySig.has(s) ? choosePreferReal(bySig.get(s), e) : e);\n  });\n  return Array.from(bySig.values());\n}\nexport const userReducer = (state = initialState, action) => {\n  switch (action.type) {\n    case \"AddUser\":\n      {\n        const doc = action.payload || {};\n        const incoming = doc && doc.user && (doc.user.username || doc.user.friends || doc.user.expensis || doc.user.expenses) ? doc.user : doc;\n        const nextFriends = Array.isArray(incoming.friends) ? incoming.friends : state.user.friends;\n        const incomingExpRaw = Array.isArray(incoming.expensis) ? incoming.expensis : Array.isArray(incoming.expenses) ? incoming.expenses : undefined;\n        const nextExpensis = Array.isArray(incomingExpRaw) ? mergeExpenseArrays(state.user.expensis, incomingExpRaw) : state.user.expensis;\n        return {\n          user: {\n            ...state.user,\n            ...incoming,\n            friends: nextFriends,\n            expensis: nextExpensis\n          }\n        };\n      }\n    case \"APPEND_EXPENSES\":\n      {\n        const add = Array.isArray(action.payload) ? action.payload : [action.payload];\n        return {\n          user: {\n            ...state.user,\n            expensis: mergeExpenseArrays(state.user.expensis, add)\n          }\n        };\n      }\n    case \"DELETE_EXPENSE\":\n      {\n        const targetSig = expSig(action.payload);\n        const targetId = pick(action.payload, [\"_id\", \"id\", \"doc._id\", \"doc.id\"]);\n        const filtered = (state.user.expensis || []).filter(e => {\n          const id = pick(e, [\"_id\", \"id\", \"doc._id\", \"doc.id\"]);\n          if (targetId && id && String(id) === String(targetId)) return false;\n          return expSig(e) !== targetSig;\n        });\n        return {\n          user: {\n            ...state.user,\n            expensis: filtered\n          }\n        };\n      }\n    case \"LOGOUT\":\n      return initialState;\n    default:\n      return state;\n  }\n};","map":{"version":3,"names":["initialState","user","_id","username","email","friends","expensis","pick","obj","paths","p","v","split","reduce","o","k","undefined","getDesc","e","getAmt","getDate","getWho","expSig","String","trim","choosePreferReal","existing","incoming","exId","inId","exIsTemp","startsWith","inIsTemp","mergeExpenseArrays","baseArr","incomingArr","bySig","Map","forEach","set","s","has","get","Array","from","values","userReducer","state","action","type","doc","payload","expenses","nextFriends","isArray","incomingExpRaw","nextExpensis","add","targetSig","targetId","filtered","filter","id"],"sources":["/Users/queen/Downloads/Budget Tracker/client/src/redux/reducers/userReducer.js"],"sourcesContent":["// src/redux/reducers/userReducer.js\r\n\r\nconst initialState = {\r\n  user: {\r\n    _id: null,\r\n    username: \"\",\r\n    email: \"\",\r\n    friends: [],\r\n    expensis: [], // canonical list\r\n  },\r\n};\r\n\r\n// --- Helpers that look into flat fields OR doc.* and inp.* ---\r\nfunction pick(obj, paths) {\r\n  for (let p of paths) {\r\n    const v = p\r\n      .split(\".\")\r\n      .reduce((o, k) => (o && o[k] !== undefined ? o[k] : undefined), obj);\r\n    if (v !== undefined && v !== null && v !== \"\") return v;\r\n  }\r\n  return undefined;\r\n}\r\nfunction getDesc(e) {\r\n  return (\r\n    pick(e, [\r\n      \"description\",\r\n      \"inp.description\",\r\n      \"doc.description\",\r\n      \"doc.inp.description\",\r\n    ]) || \"\"\r\n  );\r\n}\r\nfunction getAmt(e) {\r\n  return (\r\n    pick(e, [\"amount\", \"inp.amount\", \"doc.amount\", \"doc.inp.amount\"]) || \"\"\r\n  );\r\n}\r\nfunction getDate(e) {\r\n  return (\r\n    pick(e, [\r\n      \"date\",\r\n      \"inp.date\",\r\n      \"createdAt\",\r\n      \"updatedAt\",\r\n      \"doc.date\",\r\n      \"doc.inp.date\",\r\n      \"doc.createdAt\",\r\n      \"doc.updatedAt\",\r\n    ]) || \"\"\r\n  );\r\n}\r\nfunction getWho(e) {\r\n  return pick(e, [\"user\", \"friend\", \"paidBy\", \"with\", \"doc.user\"]) || \"\";\r\n}\r\n\r\nfunction expSig(e) {\r\n  return (\r\n    String(getDesc(e)).trim() +\r\n    \"|\" +\r\n    String(getAmt(e)) +\r\n    \"|\" +\r\n    String(getDate(e)) +\r\n    \"|\" +\r\n    String(getWho(e))\r\n  );\r\n}\r\n\r\nfunction choosePreferReal(existing, incoming) {\r\n  const exId = pick(existing, [\"_id\", \"id\", \"doc._id\", \"doc.id\"]);\r\n  const inId = pick(incoming, [\"_id\", \"id\", \"doc._id\", \"doc.id\"]);\r\n  const exIsTemp = exId && String(exId).startsWith(\"temp-\");\r\n  const inIsTemp = inId && String(inId).startsWith(\"temp-\");\r\n  if (!exId && inId) return incoming;\r\n  if (exIsTemp && !inIsTemp) return incoming;\r\n  return incoming || existing;\r\n}\r\n\r\nfunction mergeExpenseArrays(baseArr, incomingArr) {\r\n  const bySig = new Map();\r\n  (baseArr || []).forEach((e) => bySig.set(expSig(e), e));\r\n  (incomingArr || []).forEach((e) => {\r\n    const s = expSig(e);\r\n    bySig.set(s, bySig.has(s) ? choosePreferReal(bySig.get(s), e) : e);\r\n  });\r\n  return Array.from(bySig.values());\r\n}\r\n\r\nexport const userReducer = (state = initialState, action) => {\r\n  switch (action.type) {\r\n    case \"AddUser\": {\r\n      const doc = action.payload || {};\r\n      const incoming =\r\n        doc &&\r\n        doc.user &&\r\n        (doc.user.username ||\r\n          doc.user.friends ||\r\n          doc.user.expensis ||\r\n          doc.user.expenses)\r\n          ? doc.user\r\n          : doc;\r\n\r\n      const nextFriends = Array.isArray(incoming.friends)\r\n        ? incoming.friends\r\n        : state.user.friends;\r\n\r\n      const incomingExpRaw = Array.isArray(incoming.expensis)\r\n        ? incoming.expensis\r\n        : Array.isArray(incoming.expenses)\r\n        ? incoming.expenses\r\n        : undefined;\r\n\r\n      const nextExpensis = Array.isArray(incomingExpRaw)\r\n        ? mergeExpenseArrays(state.user.expensis, incomingExpRaw)\r\n        : state.user.expensis;\r\n\r\n      return {\r\n        user: {\r\n          ...state.user,\r\n          ...incoming,\r\n          friends: nextFriends,\r\n          expensis: nextExpensis,\r\n        },\r\n      };\r\n    }\r\n\r\n    case \"APPEND_EXPENSES\": {\r\n      const add = Array.isArray(action.payload)\r\n        ? action.payload\r\n        : [action.payload];\r\n      return {\r\n        user: {\r\n          ...state.user,\r\n          expensis: mergeExpenseArrays(state.user.expensis, add),\r\n        },\r\n      };\r\n    }\r\n\r\n    case \"DELETE_EXPENSE\": {\r\n      const targetSig = expSig(action.payload);\r\n      const targetId = pick(action.payload, [\"_id\", \"id\", \"doc._id\", \"doc.id\"]);\r\n      const filtered = (state.user.expensis || []).filter((e) => {\r\n        const id = pick(e, [\"_id\", \"id\", \"doc._id\", \"doc.id\"]);\r\n        if (targetId && id && String(id) === String(targetId)) return false;\r\n        return expSig(e) !== targetSig;\r\n      });\r\n      return { user: { ...state.user, expensis: filtered } };\r\n    }\r\n\r\n    case \"LOGOUT\":\r\n      return initialState;\r\n\r\n    default:\r\n      return state;\r\n  }\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}